{%- liquid
    assign main_image_source = ""
-%}

{%- capture videohtml -%}
{%- if block.settings.video != blank -%}
<video-js class="section__video-media__box main-video-container"
          data-type="video"
          data-video-autoplay="{% if section.settings.video_slide_mode contains "autoplay" %}true{% else %}false{% endif %}"
          data-buttons="{% unless section.settings.video_slide_mode contains "autoplay" %}true{% else %}false{% endunless %}">
  <video class="slide-video" playsinline=""{% if section.settings.video_slide_mode contains "muted" %} muted=""{% endif %} preload="metadata" loop="">
    {%- assign sources = block.settings.video.sources | last -%}
    <source src="{{ sources.url }}"/>
  </video>
</video-js>
{%- liquid
    if main_image_source == blank
    assign main_image_source = block.settings.video.preview_image
    endif
-%}
{%- endif -%}
{%- endcapture -%}
{%- capture videobuttonhtml -%}
{%- unless section.settings.video_slide_mode contains "autoplay" -%}
{%- liquid
    assign enable_buttons = false
    if block.settings.video != blank
    assign enable_buttons = true
    endif
    -%}
{%- if enable_buttons -%}
<div class="video-ctrl-banner video-ctrl">
  <div class="video-ctrl__play ctrl__button ctrl__button--center type2 btn-color section__video-media__ctrl--js">
    <div class="icon-play">{%- render "icon-play-2" -%}</div>
    <div class="icon-pause">{%- render "icon-pause" -%}</div>
  </div>
</div>
{%- endif -%}
{%- endunless -%}
{%- endcapture -%}

<div id="shop-the-feed-{{ block.id }}" class="section-media-buttons-parent shop-the-feed__item image-banner {% if is_slider %} slideshow for-buttons__item--js{% if is_active %} slideshow-active-in-start active{% endif %}{% endif %}{% if section.settings.video_slide_mode contains "video_on_hover" %} video_on_hover{% endif %}">
  {%- if main_image_source == blank -%}
  <div class="image-hover-scaling__box position-relative">
    <div class="image-hover-scaling__image placeholder__svg--bg border__radius" style="--aspect-ratio:0.5625;">
      {%- render "icons-placeholder-other", icon_name:'lifestyle' -%}
      {{ videohtml }}
    </div>
    {{ videobuttonhtml }}
  </div>
  {%- else -%}
  <div class="image-hover-scaling__box position-relative">
    <div class="image-hover-scaling__image border__radius" style="--aspect-ratio:0.5625;">
      {%- liquid
          if section.settings.width == "page-wide"
          assign page_is_wide = true
          else
          assign page_is_wide = false
          endif
      -%}
      {%- assign image = main_image_source -%}
      {%- capture sizes -%}
      (min-width: 1440px) {% if page_is_wide %}calc((100vw - {{ settings.spacing_grid_horizontal }}px) / 2){% else %}calc(({{ settings.page_width }}px - 20px) / 2){% endif %},(min-width: 1025px) calc((100vw - 140px) / 2),(min-width: 577px) calc((100vw - 40px - {{ settings.spacing_grid_horizontal }}px) / 2),calc((100vw - 40px - {{ settings.spacing_grid_horizontal }}px) / 2)
      {%- endcapture -%}
      {%- capture image_class -%}{% if settings.animate_image_show %}image-show--fadein{% endif %}{%- endcapture -%}            
      {%- capture animate_image_show -%}{% if settings.animate_image_show %}this.classList.add('image-loaded');{% endif %}{%- endcapture -%}
      {{
        image
        | image_url: width: image.width
        | image_tag:
          loading: 'lazy',
          width: image.width,
          height: image.height,
          class: image_class,
          sizes: sizes,
          widths: '400, 470, 620, 1240',
          onload: animate_image_show
      }}
      {{ videohtml }}
    </div>
    {{ videobuttonhtml }}
  </div>
  {%- endif -%}
  <div class="shop-the-feed__overlay"></div>

  {%- capture media -%}
  {%- assign icon_name_1 = block.settings.icon_name_1 -%}
  {%- assign url_1 = block.settings.url_1 -%}
  {%- assign icon_name_2 = block.settings.icon_name_2 -%}
  {%- assign url_2 = block.settings.url_2 -%}
  {%- if icon_name_1 != blank -%}
  <a href="{{ url_1 }}" class="shop-the-feed__media-buttons__button" aria-label="icon">{%- render "icons-list-social" icon_name: icon_name_1 -%}</a>
  {%- endif -%}
  {%- if icon_name_2 != blank -%}
  <a href="{{ url_2 }}" class="shop-the-feed__media-buttons__button" aria-label="icon">{%- render "icons-list-social" icon_name: icon_name_2 -%}</a>
  {%- endif -%}
  {%- endcapture -%}

  {%- if media != blank -%}
  <div class="shop-the-feed__media-buttons">{{ media }}</div>
  {%- endif -%}

  {%- assign product = block.settings.product -%}
  {%- liquid
      assign settings_image_ratio = section.settings.image_ratio
      assign show_badge_sold_out = section.settings.show_badge_sold_out
      assign show_badge_on_sale = section.settings.show_badge_on_sale
      assign show_badge_feature = section.settings.show_badge_feature
      assign show_secondary_image = section.settings.show_secondary_image
      assign show_vendor = section.settings.show_vendor
      assign hover_underline = section.settings.hover_underline
      assign truncate_product_name = section.settings.truncate_product_name
      assign show_price = section.settings.show_price
      assign section_id = section.id
  -%}
  <div class="shop-the-feed__product">
  {%- if product != blank -%}
  {%- liquid
      assign product_card_product = product
  -%}

  {%- liquid
  if settings_image_ratio != 'auto'
  capture image_ratio
  if settings_image_ratio == '1, round-image'
    echo settings_image_ratio | split: ',' | first
  else
    echo settings_image_ratio
  endif
  endcapture
  else
    assign image_ratio = product_card_product.featured_media.aspect_ratio
    if product_card_product.featured_media.aspect_ratio == nil
    assign image_ratio = 1
    endif
  endif
  -%}
  
  {%- assign last_characters = 'general.abbreviation_of_text_in_a_section.last_characters' | t -%}
  {%- assign image = product_card_product.featured_media -%}
      
  <div class="product-card__section-grid product-card__image-holder{% if settings.enable_zoom_animation %} image-hover-scaling-up{% endif %} position-relative hover-area{% if settings.product_card_image_resize == "contain" %} product-card-image--contain{% endif %}">
    {%- capture badges -%}
    {%- if product_card_product.available == false and show_badge_sold_out -%}
    <span class="badge badge--sold_out">{{ 'products.product.sold_out' | t }}</span>
    {%- elsif product_card_product.compare_at_price > product_card_product.price and product_card_product.available and show_badge_on_sale -%}
    <span class="badge">{{ 'products.product.on_sale' | t }}</span>
    {%- endif -%}
    {%- if product_card_product.metafields.softali.featured_badge != blank and show_badge_feature -%}
    <span class="badge badge--featured">{{ product_card_product.metafields.softali.featured_badge }}</span>
    {%- endif -%}
    {%- endcapture -%}
    {%- if image != blank -%}
    <div class="product-card__section-grid__image">    
      <div class="{% if section.settings.image_zoom_internal and image != blank and settings.enable_zoom_animation %} image-hover-scaling-internal{% endif %}{% if settings_image_ratio == '1, round-image' %} border__radius--circle{% endif %}">
        
        <a href="{{ product_card_product.url }}" class="product-card__image image-hover-scaling__image border__radius {% if settings_image_ratio == '1, round-image' %} border__radius--circle{% endif %}"
              style="--aspect-ratio: {{ image_ratio }};"
              >
          <img srcset="{{ image | image_url: width: 400 }} 1x, {{ image | image_url: width: 800 }} 2x"
                src="{{ image | image_url: width: 400 }}"
                width="{{ image.width }}"
                height="{{ image.height }}"
                loading="lazy"
                alt="{{ image.alt | escape }}"
                {% render "additional-image-attributes" %}
                >
      
          {%- if product_card_product.media[1] != nil and show_secondary_image -%}
          {% assign image = product_card_product.media[1] %}
          <img srcset="{{ image | image_url: width: 400 }} 1x, {{ image | image_url: width: 800 }} 2x"
                src="{{ image | image_url: width: 400 }}"
                width="{{ image.width }}"
                height="{{ image.height }}"
                loading="lazy"
                alt="{{ image.alt | escape }}"
                >
          {%- endif -%}    
        </a>
      </div>
    </div>
    {%- endif -%}
    
    <div class="product-card__container mt--first-child-0">
      <div id="badge__container-{{ section_id }}" class="badge__container mb10">{{- badges -}}</div>

      {%- if show_vendor and product_card_product.vendor != blank -%}
      <div class="body3">
        <p class="mt0 product-card__meta clear-underline">{{ product_card_product.vendor }}</p>
      </div>
      {%- endif -%}

      {%- if product_card_product.featured_media != blank -%}
      <div class="mt5 body2">
        <a href="{{ product_card_product.url }}" class="product-card__heading{% if hover_underline %} animation-underline animation-underline--thin{% endif %}">
          {%- if truncate_product_name -%}
          {{ product_card_product.title | escape | truncate: 48,last_characters }}
          {%- else -%}
          {{ product_card_product.title | escape }}
          {%- endif -%}
        </a>
      </div>
      {%- endif -%}
  
      {%- if show_price -%}
      {%- render 'price', product: product_card_product -%}
      {%- endif -%}
  
    </div>
  </div>
  {%- else -%}

  <div class="product-card__section-grid {% if settings.enable_zoom_animation %} image-hover-scaling-up{% endif %} hover-area">
    {%- liquid
    if settings_image_ratio != 'auto'
    capture image_ratio
    if settings_image_ratio == '1, round-image'
    echo settings_image_ratio | split: ',' | first
    else
    echo settings_image_ratio
    endif
    endcapture
    endif
    -%}
  
    <div class="{% if section.settings.image_zoom_internal and image != blank and settings.enable_zoom_animation %} image-hover-scaling-internal{% endif %}{% if settings_image_ratio == '1, round-image' %} border__radius--circle{% endif %}">
      <div class="image-hover-scaling__image placeholder__svg--bg border__radius position-relative{% if settings_image_ratio == '1, round-image' %} border__radius--circle{% endif %}"{% if settings_image_ratio != 'auto' %} style="--aspect-ratio: {{ image_ratio }};"{% endif %}>
        {{ 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg-2' }}
      </div>
    </div>
    <div class="product-card__section-grid__container mt--first-child-0">
      {%- if show_vendor -%}
      <div class="body3 product-card__meta">VENDOR</div>
      {%- endif -%}
      
      <div class="mt5 body2 product-card__heading{% if hover_underline %} animation-underline animation-underline--thin{% endif %}">
        {%- if truncate_product_name -%}
        {{ "Product name" | escape | truncate: 48,'...' }}
        {%- else -%}
        {{ "Product name" | escape }}
        {%- endif -%}
      </div>
      {%- if show_price -%}
      <div class="price mt5">
        <div class="price__regular body2">$12.18{% if settings.currency_code_enabled %} USD{% endif %}</div>
        <div class="price__sale card__price__main h5">From $8.66{% if settings.currency_code_enabled %} USD{% endif %}</div>
      </div>
      {%- endif -%}
    </div>
  </div>

  {%- endif -%}
  </div>
</div>